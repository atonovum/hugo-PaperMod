{{- $headers := findRE "<h[1-6].*?>(.|\n])+?</h[1-6]>" .Content -}}
{{- $has_headers := ge (len $headers) 1 -}}
{{- if $has_headers -}}
<aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <div class="inner">
            {{- $toc := .TableOfContents -}}
            {{- $toc = replaceRE "<ul>" "<ul id=\"toc-list\">" $toc -}}
            {{- $toc | safeHTML -}}
        </div>
    </div>
</aside>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            const id = entry.target.getAttribute('id');
            const tocLink = document.querySelector(`#toc-list li a[href="#${id}"]`);
            
            if (entry.isIntersecting) {
                document.querySelectorAll('#toc-list li a').forEach(link => link.classList.remove('active'));
                if (tocLink) tocLink.classList.add('active');
            }
        });
    }, { rootMargin: '-10% 0px -80% 0px' });

    // 본문의 모든 헤딩 감시
    document.querySelectorAll('.post-content h1, .post-content h2, .post-content h3').forEach((section) => {
        observer.observe(section);
    });
});
</script>
{{- end }}
